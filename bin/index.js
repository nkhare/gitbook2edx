// Generated by LiveScript 1.3.1
(function(){
  var docopt, _, fs, build, condense, write, gitbook, shelljs, doc, getOption, o, sourceDir, bookDir, yamlConfig;
  docopt = require('docopt').docopt;
  _ = require('lodash');
  fs = require('fs');
  build = require('./build').build;
  condense = require('./condense').condense;
  write = require('./write').write;
  gitbook = require('./gitbook').gitbook;
  shelljs = require('shelljs');
  doc = shelljs.cat(__dirname + "/../docs/usage.md");
  getOption = function(a, b, def, o){
    if (!o[a] && !o[b]) {
      return def;
    } else {
      return o[b];
    }
  };
  o = docopt(doc);
  sourceDir = o['DIR'];
  bookDir = sourceDir + "/_book";
  yamlConfig = getOption('-c', '--config', sourceDir + "/config.yaml", o);
  if (o['json']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(function(it){
      return console.log(JSON.stringify(it, 0, 4));
    });
  }
  if (o['build']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(build).then(function(it){
      return console.log(it);
    });
  }
  if (o['gen']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(build).then(write);
  }
}).call(this);
