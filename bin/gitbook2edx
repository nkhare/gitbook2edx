#!/usr/bin/env node
// Generated by LiveScript 1.3.1
(function(){
  var docopt, _, fs, build, condense, write, gitbook, chalk, shelljs, doc, getOption, o, sourceDir, bookDir, yamlConfig;
  docopt = require('docopt').docopt;
  _ = require('lodash');
  fs = require('fs');
  build = require('./build').build;
  condense = require('./condense').condense;
  write = require('./write').write;
  gitbook = require('./gitbook').gitbook;
  chalk = require('chalk');
  shelljs = require('shelljs');
  doc = shelljs.cat(__dirname + "/../docs/usage.md");
  getOption = function(a, b, def, o){
    if (!o[a] && !o[b]) {
      return def;
    } else {
      return o[b];
    }
  };
  o = docopt(doc);
  sourceDir = o['DIR'];
  bookDir = sourceDir + "/_book";
  yamlConfig = getOption('-c', '--config', sourceDir + "/config.yaml", o);
  if (o['json']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(function(it){
      return console.log(JSON.stringify(it, 0, 4));
    })['catch'](function(){
      return process.exit(1);
    });
  }
  if (o['build']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(build).then(function(it){
      return console.log(it);
    })['catch'](function(){
      return process.exit(1);
    });
  }
  if (o['gen']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(build).then(write)['catch'](function(){
      return process.exit(1);
    });
  }
  if (o['info']) {
    gitbook(sourceDir).then(function(){
      return condense(bookDir, sourceDir, yamlConfig);
    }).then(function(it){
      console.log(chalk.bold("Course name:   ") + it.course.displayName + "   (not part of the url)");
      console.log(chalk.bold("Organization:  ") + it.organization.name);
      console.log(chalk.bold("Course number: ") + it.course.number);
      return console.log(chalk.bold("Course run:    ") + it.course.year + "-" + it.course.season);
    })['catch'](function(){
      return process.exit(1);
    });
  }
}).call(this);
